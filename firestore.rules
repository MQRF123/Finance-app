rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ==== helpers ====
    function isOwner(ownerId) {
      return request.auth != null && ownerId == request.auth.uid;
    }

    // Cada usuario solo ve / crea / actualiza / borra sus simulaciones
    match /simulaciones/{id} {
      // Leer (get + list/query) si el doc pertenece al usuario
      allow read: if isOwner(resource.data.userId);

      // Crear si el userId del doc coincide con el usuario autenticado
      allow create: if isOwner(request.resource.data.userId);

      // Actualizar / Borrar si el doc pertenece al usuario
      allow update, delete: if isOwner(resource.data.userId);
    }

    // (Opcional) clientes del usuario
    match /clientes/{id} {
      allow create: if isOwner(request.resource.data.ownerUid);
      allow read, update, delete: if isOwner(resource.data.ownerUid);
    }

    // (Opcional) proyectos visibles a todos los autenticados (solo lectura)
    match /proyectos/{id} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }

    // Bloquear todo lo dem√°s
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
